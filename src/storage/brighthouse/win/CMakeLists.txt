cmake_minimum_required(VERSION 2.6)

# This reads user configuration, generated by configure.js.
# INCLUDE(win/configure.data)

SET(localstatedir "C:\\mysql\\data")

# in some places we use DBUG_OFF
SET(CMAKE_CXX_FLAGS "-DUSE_SYS_STL")
SET(CMAKE_C_FLAGS "-DUSE_SYS_STL")
SET(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} -D DBUG_OFF")
SET(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE} -D DBUG_OFF")

IF(CMAKE_GENERATOR MATCHES "Visual Studio" AND CMAKE_SIZEOF_VOID_P MATCHES 4)
  ADD_DEFINITIONS(-D_USE_32BIT_TIME_T)
ENDIF(CMAKE_GENERATOR MATCHES "Visual Studio" AND CMAKE_SIZEOF_VOID_P MATCHES 4)

IF(CMAKE_GENERATOR MATCHES "Visual Studio 8" OR
   CMAKE_GENERATOR MATCHES "Visual Studio 9")
    SET(CMAKE_CXX_FLAGS_DEBUG "${CMAKE_CXX_FLAGS_DEBUG} /wd4996 /MP")
    SET(CMAKE_CXX_FLAGS_RELEASE "${CMAKE_CXX_FLAGS_RELEASE} /wd4996 /MP")
    SET(CMAKE_C_FLAGS_DEBUG "${CMAKE_C_FLAGS_DEBUG} /wd4996 /MP")
    SET(CMAKE_C_FLAGS_RELEASE "${CMAKE_C_FLAGS_RELEASE} /wd4996 /MP")
ENDIF(CMAKE_GENERATOR MATCHES "Visual Studio 8" OR
      CMAKE_GENERATOR MATCHES "Visual Studio 9")

IF(CMAKE_GENERATOR MATCHES "Visual Studio 7" OR 
   CMAKE_GENERATOR MATCHES "Visual Studio 8" OR
   CMAKE_GENERATOR MATCHES "Visual Studio 9")

	ADD_DEFINITIONS(-D_WIN32_WINNT=0x0501)

	# replace /MDd with /MTd
	STRING(REPLACE "/MDd" "/MTd" CMAKE_CXX_FLAGS_DEBUG_INIT 
	       ${CMAKE_CXX_FLAGS_DEBUG_INIT})
	STRING(REPLACE "/MDd" "/MTd" CMAKE_C_FLAGS_DEBUG_INIT 
	       ${CMAKE_C_FLAGS_DEBUG_INIT})
	STRING(REPLACE "/MD" "/MT" CMAKE_C_FLAGS_RELEASE 
	       ${CMAKE_C_FLAGS_RELEASE})
	STRING(REPLACE "/MDd" "/MTd" CMAKE_C_FLAGS_DEBUG 
	       ${CMAKE_C_FLAGS_DEBUG})
	STRING(REPLACE "/MD" "/MT" CMAKE_CXX_FLAGS_RELEASE 
	       ${CMAKE_CXX_FLAGS_RELEASE})
	STRING(REPLACE "/MDd" "/MTd" CMAKE_CXX_FLAGS_DEBUG 
	       ${CMAKE_CXX_FLAGS_DEBUG})

	SET( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /GX" )
	SET( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /EHsc" )
	SET( CMAKE_CXX_FLAGS_INIT "${CMAKE_CXX_FLAGS_INIT} /EHsc" )
	SET( CMAKE_CXX_FLAGS_DEBUG_INIT "${CMAKE_CXX_FLAGS_DEBUG_INIT} /EHsc" )
	# remove support for Exception handling
	#   STRING(REPLACE "/GX" "" CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS})
	#   STRING(REPLACE "/EHsc" "" CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS})
	#   STRING(REPLACE "/EHsc" "" CMAKE_CXX_FLAGS_INIT 
	#          ${CMAKE_CXX_FLAGS_INIT})
	#   STRING(REPLACE "/EHsc" "" CMAKE_CXX_FLAGS_DEBUG_INIT 
	#          ${CMAKE_CXX_FLAGS_DEBUG_INIT})
ENDIF(CMAKE_GENERATOR MATCHES "Visual Studio 7" OR 
      CMAKE_GENERATOR MATCHES "Visual Studio 8" OR
      CMAKE_GENERATOR MATCHES "Visual Studio 9")

ADD_DEFINITIONS("-DMYSQL_SERVER -D_WINDOWS -D__WIN__ -D _CRT_SECURE_NO_DEPRECATE")

ADD_SUBDIRECTORY(compress)
ADD_SUBDIRECTORY(common)
ADD_SUBDIRECTORY(system)
ADD_SUBDIRECTORY(memmngr)
ADD_SUBDIRECTORY(handler)
ADD_SUBDIRECTORY(loader)
ADD_SUBDIRECTORY(engine)
ADD_SUBDIRECTORY(core)
ADD_SUBDIRECTORY(vc)
ADD_SUBDIRECTORY(domaininject)

set( IB_ROOT "${CMAKE_SOURCE_DIR}/../../" )
IF ( EXISTS "${IB_ROOT}/QA/ut/CMakeLists.txt" )
	ADD_SUBDIRECTORY(../../../../QA/ut ../../../../build/ut)
ENDIF()
IF ( EXISTS "${IB_ROOT}/test/CMakeLists.txt" )
	ADD_SUBDIRECTORY(../../../../tools/UnitTest++ ../../../../build/UnitTest++ )
	ADD_SUBDIRECTORY(../../../../test ../../../../build/test )
ENDIF()

